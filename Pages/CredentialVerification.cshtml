@page
@model Affinidi_Login_Demo_App.Pages.CredentialVerificationModel
@{
    ViewData["Title"] = "Credential Verification";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-dark text-white text-center">
                    <h3 class="mb-0">@ViewData["Title"]</h3>
                </div>
                <div class="card-body p-5">
                    <p class="lead mb-4 text-center">
                        Paste the Verifiable Credential (VC) or Verifiable Presentation (VP) in the text area below to verify it.
                    </p>

                    <form method="post">
                        <!-- Radio buttons for VC / VP -->
                        <div class="d-flex justify-content-center mb-3">
                            <div class="btn-group" role="group" aria-label="VC/VP Toggle">
                                <input type="radio" class="btn-check" name="CredentialType" id="vcRadio" value="VC"
                                    @(Model.CredentialType == "VC" || string.IsNullOrEmpty(Model.CredentialType) ? "checked" : "") autocomplete="off">
                                <label class="btn btn-outline-primary" for="vcRadio">VC</label>

                                <input type="radio" class="btn-check" name="CredentialType" id="vpRadio" value="VP"
                                    @(Model.CredentialType == "VP" ? "checked" : "") autocomplete="off">
                                <label class="btn btn-outline-primary" for="vpRadio">VP</label>
                            </div>
                        </div>

                        <!-- Text area for JSON input -->
                        <div class="form-floating mb-3">
                            <textarea class="form-control" placeholder="Paste credential here"
                                      id="credentialData" name="CredentialData" style="height: 200px">@Model.CredentialData</textarea>
                            <label for="credentialData" id="credentialLabel">Paste your Verifiable Credential</label>
                        </div>

                        <!-- Submit button -->
                        <div class="d-grid">
                            <button class="btn btn-primary btn-lg" type="submit">Verify Credential</button>
                        </div>
                    </form>

                    @if (Model.VerificationResult != null)
                    {
                        <div class="alert alert-info mt-4 text-break">
                            <strong>Verification Result:</strong>
                            <pre>@Model.VerificationResult</pre>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const vcRadio = document.getElementById('vcRadio');
    const vpRadio = document.getElementById('vpRadio');
    const label = document.getElementById('credentialLabel');
    const textarea = document.getElementById('credentialData');

    function updateLabel() {
        if (textarea.value.trim().length === 0) {
            label.textContent = vcRadio.checked
                ? "Paste your Verifiable Credential"
                : "Paste your Verifiable Presentation";
        } else {
            label.textContent = "";
        }
    }

    function handleTypeChange() {
        // Clear textarea only if it has content
        if (textarea.value.trim().length > 0) {
            textarea.value = "";
        }
        updateLabel();
    }

    vcRadio.addEventListener('change', handleTypeChange);
    vpRadio.addEventListener('change', handleTypeChange);
    textarea.addEventListener('input', updateLabel);

    // Initialize on page load
    updateLabel();
</script>

